Техническое задание: Расчёт моды времени проезда по участку 5–4

Используются две таблицы:

"auto_fixation" с атрибутами:
auto_num - Номерной знак автомобиля в формате А111ААNNNRU или А111ААNNRU, где А-латинская буква,1-арабскаяч цифра, N - арабская цифра, NNN или NN - код автомобильного региона;
fix_dttm - Дата и время фиксации проезда под камерой;
direction - Направление проезда (1 - по направлению камеры, 0 - на встречу камере);
camera_id - Идентификатор камеры фото-видео фиксации;
fix_speed - Зафиксированная скорость проезда автомобиля

"camera" с атрибутами:
camera_id - Идентификатор камеры фото-видео фиксации;
latitude - Широта расположения камеры;
longitude - Долгота расположения камеры;
azimut - Азимут расположения камеры;
district_nm - Наименование района расположения камеры;
allowed_speed - Максимальная разрешённая скорость проезда под камерой

Цель

Разработать SQL-запрос (или ETL-логику), который определяет среднюю (моду) продолжительность проезда по участку от камеры 5 до камеры 4 за последние 6 месяцев, с разбивкой по:
1. Дням недели (0 — воскресенье, …, 6 — суббота);
2. Периодам суток:
    07:00–11:00 — утро
    11:00–17:00 — день
    17:00–21:00 — вечер
    21:00–07:00 — ночь

Логика алгоритма

1. Отбор данных за последние 6 месяцев от текущей даты.
2. Выделение фиксаций:
    Камера 5 — начало проезда
    Камера 4 — окончание проезда
3. Сопоставление по auto_num:
    Время на камере 5 должно быть раньше, чем на камере 4
4. Расчёт продолжительности проезда в секундах.
5. Определение периода суток по fix_dttm на камере 5:
    07:00–11:00 - morning
    11:00–17:00 - day
    17:00–21:00 - evening
    21:00–07:00 - night
6. Группировка по дню недели и времени суток.
7. Поиск моды — значения продолжительности проезда в группе.

Выходной формат

Результат — таблица с колонками:
weekday - День недели (0 — воскресенье, …, 6 — суббота);
period - Временной интервал (morning, day, и т.п.);
mode_duration - Продолжительность проезда в секундах (мода)